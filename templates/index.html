<!doctype html>
<html lang="en">
    <head>
        {% load static %}
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport"
            content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="theme-color" content="#000000">
        <title>Cash Pipe - {% block page-title %}Send Money{% endblock %}</title>
        <meta name="description" content="Mobilekit HTML Mobile UI Kit">
        <meta name="keywords" content="bootstrap 4, mobile template, cordova, phonegap, mobile, html" />
        <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png' %}" sizes="32x32">
        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'assets/img/icon/192x192.png' %}">
        <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
        <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">
        <link rel="manifest" href="{% static '__manifest.json' %}">
    </head>

    <body class="bg-white">
        <!-- loader -->
        <div id="loader">
            <div class="spinner-border text-primary" role="status"></div>
        </div>
        <!-- * loader -->

        {% block app-header %}{% endblock %}

        {% block app-capsule %}
        {% include 'inc/capsules/_index.html' %}
        {% endblock %}

        {% block bottom-menu %}
        {% if user.is_authenticated %}
            {% include 'inc/bottom-menu.html' %}
        {% endif %}
        {% endblock %}

        <!-- ///////////// Js Files ////////////////////  -->
        <!-- Jquery -->
        <script src="{% static 'assets/js/lib/jquery-3.4.1.min.js' %}"></script>
        <!-- Bootstrap-->
        <script src="{% static 'assets/js/lib/popper.min.js' %}"></script>
        <script src="{% static 'assets/js/lib/bootstrap.min.js' %}"></script>
        <!-- Ionicons -->
        <script type="module" src="https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.js"></script>
        <!-- Owl Carousel -->
        <script src="{% static 'assets/js/plugins/owl-carousel/owl.carousel.min.js' %}"></script>
        <!-- jQuery Circle Progress -->
        <script src="{% static 'assets/js/plugins/jquery-circle-progress/circle-progress.min.js' %}"></script>
        <!-- Base Js File -->
        <script src="{% static 'assets/js/base.js' %}"></script>
        {% block form-js %}
        <!-- <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.2/dist/jquery.validate.min.js"></script> -->
        <script>
            (function() {
                // $(".disable-btn-on-submit").validate();
                $(".disable-btn-on-submit").submit(function () {
                    $("#btn-submit").attr("disabled", true);
                    return true;
                });
            });
        </script>
        {% endblock %}
        {% block page-js %}
        <script src="https://unpkg.com/autonumeric"></script>
        <script>
            AutoNumeric.multiple(['#source_amount', '#dest_amount']);

            let rate, destAmount, symbol;
            const showRate = rate => $('#rate').text(rate);
            const getSourceCurrency = () => $('#id_source_currency').val();
            const getSourceAmount = () => parseInt($('#source_amount').val().replace(/,/g, ''));
            const setDest = (sourceAmount, rate, symbol) => {
                destAmount = sourceAmount * parseFloat(rate);
                $('#dest_amount').val(symbol + destAmount.toLocaleString('en'));
            }

            if (getSourceCurrency() != 'BTC') {
                $('#id_dest_currency').parents('.form-group').hide();
            }

            showRate({{ rates.ngn_to_ghs }});
            setDest(getSourceAmount(), {{ rates.ngn_to_ghs}}, 'GH₵');

            $('#id_source_currency').change(() => {
                const sc = getSourceCurrency();
                if (sc == 'NGN') {
                    symbol = 'GH₵';
                    rate = {{ rates.ngn_to_ghs }};
                    showRate(rate);
                    setDest(getSourceAmount(), rate, symbol);
                }

                if (sc == 'GHS') {
                    symbol = '₦';
                    rate = {{ rates.ghs_to_ngn }};
                    showRate(rate);
                    setDest(getSourceAmount(), rate, symbol);
                }
            });

            /* $('#source_amount').keyup(() => {
                const sa = parseInt($('#source_amount').val().replace(/,/g, ''));
                const scc = $('#id_source_currency').val();
            }); */
        </script>
        {% endblock %}
    </body>
</html>