<!doctype html>
<html lang="en">
    <head>
        {% load static %}
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport"
            content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="theme-color" content="#000000">
        <title>Cash Pipe - {% block page-title %}Send Money{% endblock %}</title>
        <meta name="description" content="Mobilekit HTML Mobile UI Kit">
        <meta name="keywords" content="bootstrap 4, mobile template, cordova, phonegap, mobile, html" />
        <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png' %}" sizes="32x32">
        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'assets/img/icon/192x192.png' %}">
        <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
        <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">
        <link rel="manifest" href="{% static '__manifest.json' %}">
    </head>

    <body class="bg-white">
        <!-- loader -->
        <div id="loader">
            <div class="spinner-border text-primary" role="status"></div>
        </div>
        <!-- * loader -->

        {% block app-header %}{% endblock %}

        {% block app-capsule %}
        {% include 'inc/capsules/_index.html' %}
        {% endblock %}

        {% block bottom-menu %}
        {% if user.is_authenticated %}
            {% include 'inc/bottom-menu.html' %}
        {% endif %}
        {% endblock %}

        <!-- ///////////// Js Files ////////////////////  -->
        <!-- Jquery -->
        <script src="{% static 'assets/js/lib/jquery-3.4.1.min.js' %}"></script>
        <!-- Bootstrap-->
        <script src="{% static 'assets/js/lib/popper.min.js' %}"></script>
        <script src="{% static 'assets/js/lib/bootstrap.min.js' %}"></script>
        <!-- Ionicons -->
        <script type="module" src="https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.js"></script>
        <!-- Owl Carousel -->
        <script src="{% static 'assets/js/plugins/owl-carousel/owl.carousel.min.js' %}"></script>
        <!-- jQuery Circle Progress -->
        <script src="{% static 'assets/js/plugins/jquery-circle-progress/circle-progress.min.js' %}"></script>
        <!-- Base Js File -->
        <script src="{% static 'assets/js/base.js' %}"></script>
        {% block form-js %}
        <!-- <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.2/dist/jquery.validate.min.js"></script> -->
        <script>
            (function() {
                // $(".disable-btn-on-submit").validate();
                $(".disable-btn-on-submit").submit(function () {
                    $("#btn-submit").attr("disabled", true);
                    return true;
                });
            });
        </script>
        {% endblock %}
        {% block page-js %}
        <script src="https://unpkg.com/autonumeric"></script>
        <script>
            new AutoNumeric('#id_source_amount', {
                'decimalPlaces': 8,
                'allowDecimalPadding': false
            })

            const SOURCE_CURRENCY_RATE_SYMBOL_MAP = {
                'NGN': [{{ rates.ngn_to_ghs }}, 'GH₵'],
                'GHS': [{{ rates.ghs_to_ngn }}, '₦'],
                'BTC': {
                    'NGN': [{{ rates.btc_to_ngn }}, '₦'],
                    'GHS': [{{ rates.btc_to_ghs }}, 'GH₵']
                }
            };

            let rate, destAmount, symbol;
            const showRate = rate => $('#rate').text(rate.toLocaleString('en', { minimumFractionDigits: 4 }));
            const getCurrency = (element) => $(element).val();
            const getAmount = (element) => $(element).val().replace(/,/g, '');
            const showAmount = (element, rate, symbol) => {
                let amount;
                if (element == '#id_dest_amount') {
                    amount = getAmount('#id_source_amount');
                } else {
                    amount = getAmount('#id_dest_amount');
                }
                if (isNaN(amount)) {
                    $(element).val('');
                } else {
                    displayAmount = amount * parseFloat(rate);
                    $(element).val(symbol + displayAmount.toLocaleString('en'));
                }
            }

            // Hide dest currency field by default
            $('#id_dest_currency').parents('.form-group').hide();

            // Display rate and amount based on default form values
            // $('#id_source_currency').val('NGN');
            showRate({{ rates.ngn_to_ghs }});
            showAmount('#id_dest_amount', {{ rates.ngn_to_ghs}}, 'GH₵');

            $('#id_source_currency').change(() => {
                const sc = getCurrency('#id_source_currency');
                if (sc != 'BTC') {
                    if (sc == 'NGN') {
                        $('#id_dest_currency').val('GHS');
                    } else {
                        $('#id_dest_currency').val('NGN');
                    }
                    // Hide dest currency field if source currency changes to Naira or Cedis
                    $('#id_dest_currency').parents('.form-group').hide();
                    [rate, symbol] = SOURCE_CURRENCY_RATE_SYMBOL_MAP[getCurrency('#id_source_currency')];
                } else {
                    // Show dest currency field and get BTC rates and symbols
                    $('#id_dest_currency').parents('.form-group').show();
                    [rate, symbol] = SOURCE_CURRENCY_RATE_SYMBOL_MAP['BTC'][getCurrency('#id_dest_currency')];
                }
                // Display rate and amount with symbol
                showRate(rate);
                showAmount('#id_dest_amount', rate, symbol);
            });

            $('#id_source_amount').keyup(() => {
                const sc = getCurrency('#id_source_currency');
                if (sc != 'BTC') {
                    [rate, symbol] = SOURCE_CURRENCY_RATE_SYMBOL_MAP[sc];
                } else {
                    [rate, symbol] = SOURCE_CURRENCY_RATE_SYMBOL_MAP['BTC'][getCurrency('#id_dest_currency')];
                }
                showAmount('#id_dest_amount', rate, symbol);
            });

            $('#id_dest_currency').change(() => {
                [rate, symbol] = SOURCE_CURRENCY_RATE_SYMBOL_MAP['BTC'][getCurrency('#id_dest_currency')];
                showRate(rate);
                showAmount('#id_dest_amount', rate, symbol);
            })
        </script>
        {% endblock %}
    </body>
</html>